"use strict";var Picimage=function(){function a(a){var a=new URI(a);return a.filename()||"image"+index+".jpg"}function b(){$(document).on("click","#"+i+" .close",function(){e()}),$(document).on("change","#pick-image-check-all",function(){$(this).is(":checked")?$("#"+i+" .item .select input ").prop("checked",!0):$("#"+i+" .item .select input ").prop("checked",!1)}),$(document).on("click","#"+i+" .modal-footer .download-all-button ",function(){var b=new JSZip,c=0,d=$("#"+i+" .item .select input:checked").length,e=[];return 1>d?void alert("선택목록이 없습니다."):void $.each($("#"+i+" .item .select input "),function(f,g){if(1==$(g).is(":checked")){var h=$(g).parents(".item").find(".img-wrapper .thumb").prop("src"),i=a(h);JSZipUtils.getBinaryContent(h,function(a,f){if(a)e.push(h);else{var g=b.folder("images");g.file(i,f,{binary:!0})}if(c++,c==d){e.length>0&&b.file("error.txt",e.join("\n"));var j=b.generate({type:"blob"});saveAs(j,"image.zip")}})}})}),$(document).on("mouseenter","#"+i+" .item ",function(){$(this).find(".menu").addClass("active")}).on("mouseleave","#"+i+" .item ",function(){$(this).find(".menu").removeClass("active")}),$(document).keydown(function(a){27==a.keyCode&&e()}),$(document).on("click","#"+i+" .item .info-button",function(){$(this).parents(".item").find(".info").toggleClass("active")}),$(document).on("click","#"+i+" .item .info input",function(){$(this).select()}),$(document).on("click","#"+i+" .item .download-button",function(){var b=$(this).parents(".item").find(".thumb").prop("src"),c=$("<a>").attr("href",b).attr("download",a(b)).appendTo("body");c[0].click(),c.remove()}),$(document).on("click","#"+i+" .item .fullsize",function(){var a=$(this).parents(".item").find(".img-wrapper .thumb").prop("src"),b=c(chrome.extension.getURL("html/fullscreen.html"));$("body").append(Mustache.render(b,{images:l,current_src:a})),$(".pic-image-full").addClass("active"),screenfull.request($(".pic-image-full")[0])}),$(document).on(screenfull.raw.fullscreenchange,"",function(){0==screenfull.isFullscreen&&$(".pic-image-full").remove()}),$(document).on("click",".pic-image-full .full-footer img",function(){console.log($(this).parents(".pic-image-full").find(".full-container .full-preview div img")),$(this).parents(".pic-image-full").find(".full-container .full-preview div img").attr("src",$(this).prop("src"))})}function c(a){return $.ajax({type:"GET",url:a,cache:!1,async:!1}).responseText}function d(){$("#"+i).css("display","block")}function e(){$("#"+i).remove()}function f(){var a=[],b=0;return $.each($("img"),function(c,d){$(d).prop("naturalWidth")>j&&$(d).prop("naturalHeight")>k&&(a.push({src:$(d).prop("src"),index:b}),b++)}),$.each($("div"),function(c,d){if(""!=$(d).css("background-image")){var e=/^url\((['"]?)(.*)\1\)$/.exec($(d).css("background-image"));if(e=e?e[2]:"",""!=e){var f=$("<img src='"+e+"' style='display:none;'>").appendTo("body");$(f).prop("naturalWidth")>j&&$(f).prop("naturalHeight")>k&&(a.push({src:e,index:b}),b++),f.remove()}}}),a}function g(a){var b=c(chrome.extension.getURL("html/item.html")),d={images:a,full_src:function(){return chrome.extension.getURL("images/fullsize.png")}};return Mustache.render(b,d)}function h(){if(l=f(),l.length<1)return void alert("적합한 이미지를 찾을수 없습니다.");var a=c(chrome.extension.getURL("html/modal.html")),b=g(l);$("body").append(Mustache.render(a,{items:b,count:l.length})),d()}var i="pic-image-dummy",j=160,k=100,l=void 0;return b(),{show:h}}();